# =========================================================
# Regiongemensam hubb – flöde, federering och distribution
# D2-version (arkitekturvy med flöden)
# Förenklad för kroki.io-kompatibilitet
# =========================================================

direction: right

# Aktorer
region: Region {
  shape: rectangle
  style.fill: "#C7F9CC"
  style.stroke: "#16A34A"

  basunderlag: Basunderlag (brett)
  urval: Urval A/B/C/D

  basunderlag -> urval: ETL + DQ
}

hubb: Hubb (VGR) {
  shape: rectangle
  style.fill: "#BFDBFE"
  style.stroke: "#2563EB"

  standardpaket: Standardpaket P1-P7
  benchmark: Benchmark-motor
  transport: Blind Relay
  policy: Policy-gate
}

spe: SPE {
  shape: rectangle
  style.fill: "#DDD6FE"
  style.stroke: "#7C3AED"
  label: "SPE\n(Federerad berakning)"
}

externa: Externa {
  shape: rectangle
  style.fill: "#FED7AA"
  style.stroke: "#EA580C"

  sos: Socialstyrelsen
  ovriga: Ovriga externa
}

# PUSH-floden
hubb.standardpaket -> region: 1. Publicerar standardpaket {
  style.stroke: "#2563EB"
}

region.urval -> hubb.benchmark: 2. Urval A (PN-fritt) {
  style.stroke: "#16A34A"
}

hubb.benchmark -> region: Aterkoppling {
  style.stroke: "#16A34A"
  style.stroke-dash: 3
}

region.urval -> hubb.transport: 3. Krypterat paket {
  style.stroke: "#EA580C"
}

hubb.transport -> externa.sos: Blind relay {
  style.stroke: "#EA580C"
}

hubb.transport -> externa.ovriga: Blind relay {
  style.stroke: "#EA580C"
}

# PULL-floden (federering)
hubb.policy -> spe: 4. Federerad fraga {
  style.stroke: "#7C3AED"
}

externa.ovriga -> hubb.policy: Begar analys {
  style.stroke: "#7C3AED"
  style.stroke-dash: 3
}

spe -> region.basunderlag: Fraga + urval {
  style.stroke: "#7C3AED"
}

region.basunderlag -> spe: Delresultat {
  style.stroke: "#7C3AED"
  style.stroke-dash: 3
}

# Info-ruta
info: {
  shape: rectangle
  style.fill: "#FEE2E2"
  style.stroke: "#DC2626"
  label: "Viktigt:\n- Hubben kan EJ dekryptera\n- Endast benchmark lagras\n- Radata stannar i regionen"
}
